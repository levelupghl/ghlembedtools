/*!***************************************
 * Level Up GHL Embed Tools
 * https//levelupghl.com
 * Version: v1.0.3
 ****************************************/(function(d){"use strict";function y(e,t){let o;return function(){const n=()=>{clearTimeout(o),e()};clearTimeout(o),o=window.setTimeout(n,t)}}function b(e=null){let t;e?t=e.startsWith("?")?e:new URL(e).search:t=window.location.search||new URL(window.location.href).search;const o=new URLSearchParams(t),n={};return o.forEach((r,u)=>{n[u]=r}),n}function p(e){const t={};return e.forEach(o=>{for(const n in o)o.hasOwnProperty(n)&&(t[n]=o[n])}),t}function L(){try{const e="__storage_test__",t=window.localStorage;t.setItem(e,e);const o=t.getItem(e);return t.removeItem(e),e===o}catch(e){return!1}}var m,f;const P=!1,T="iframe:not([data-embed-tools-init])",w=[],I=window.location.search,_=L(),E=["/form","/survey","/booking","/group"];let l=[];const s={debug:P,sendQueryParams:g};function g(e,t=null){v(e,t),l.push(e)}function v(e,t=null){t?h(t,e):w.forEach(o=>{h(o,e)})}function h(e,t){var o,n;const r=new URL(document.location.href),u=e.dataset.embedToolsLocationId,c=Q(u),i=c?c.referrer:document.referrer,a=((o=e.dataset)==null?void 0:o.layoutIframeId)||e.id;(n=e.contentWindow)==null||n.postMessage(["query-params",t,r.toString(),i,a],"*")}function Q(e){if(!_||!e)return;const t=`v3_first_session_event_${e}`;try{const o=localStorage.getItem(t);if(!o)return null;const n=JSON.parse(o);return new Date().getTime()>n.expiry?(localStorage.removeItem(t),null):n.value}catch(o){return null}}function S(e){if(!e)return;const t=Array.from(document.getElementsByTagName("iframe"));for(let o of t)if(o.contentWindow===e)return o}function O(e){s.debug&&console.log("[EMBEDTOOLS] received message:",e,e.data);const t=e.data;if(typeof t=="object"&&t[0]==="fetch-query-params"){const o=S(e.source);o&&(o.dataset.embedToolsLocationId=t[2]);const n=window.location.search.length>1?window.location.search:I;let r=b(n);l&&l.length&&(r=p([r,...l])),setTimeout(()=>{v(r,o||null)},10)}}function q(e){var t,o,n,r,u;const c=a=>{if(a.dataset.embedToolsInit)return!1;const U=a.src||a.dataset.src||"";return E.some(A=>U.includes(A))},i=()=>{Array.from(e.querySelectorAll(T)).filter(c).forEach(a=>{a.dataset.embedToolsInit="true",w.push(a)})};window.addEventListener("message",O),i(),(n=(o=(t=window.levelup)==null?void 0:t.sendQueryParams)==null?void 0:o.queue)!=null&&n.length&&(l=(u=(r=window.levelup)==null?void 0:r.sendQueryParams)==null?void 0:u.queue),new MutationObserver(y(i,50)).observe(e.body,{attributes:!1,childList:!0,subtree:!0})}return q(window.document),window.levelup?((m=window.levelup).debug!=null||(m.debug=s.debug),(f=window.levelup).sendQueryParams!=null||(f.sendQueryParams=s.sendQueryParams)):window.levelup=s,console.log("Powered by Level Up Embed Tools v1.0.3:","https://levelupghl.com"),d.sendQueryParams=g,d})({});
//# sourceMappingURL=queryParams.min.js.map
